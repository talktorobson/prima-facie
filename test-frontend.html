<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prima Facie - Centro de Testes Frontend</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #0066CC 0%, #004499 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        .header h1 { 
            margin: 0; 
            font-size: 1.8em; 
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .header p { margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9em; }
        .phase-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .phase-indicator {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            backdrop-filter: blur(10px);
        }
        .phase-indicator.complete {
            background: rgba(40,167,69,0.3);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        /* Main Layout */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 300px 1fr 400px;
            gap: 20px;
            min-height: calc(100vh - 80px);
        }
        
        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        /* Console Column */
        .console-column {
            position: sticky;
            top: 100px;
            height: fit-content;
            max-height: calc(100vh - 120px);
        }
        
        /* Card Styles */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            padding: 20px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid #e9ecef;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }
        .card h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        
        /* Quick Actions Card */
        .quick-actions {
            display: grid;
            gap: 8px;
        }
        .quick-action-btn {
            background: white;
            border: 2px solid #e9ecef;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #2c3e50;
        }
        .quick-action-btn:hover {
            background: #f8f9fa;
            border-color: #0066CC;
            transform: translateX(5px);
        }
        .quick-action-btn .icon {
            font-size: 20px;
            width: 30px;
            text-align: center;
        }
        
        /* Status Indicators */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        .status-card {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid;
        }
        .status-card.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .status-card.warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        .status-card.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .status-card h4 {
            margin: 0 0 5px 0;
            font-size: 14px;
        }
        .status-card p {
            margin: 0;
            font-size: 12px;
        }
        
        /* Console Styles */
        #test-console {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            height: calc(100vh - 300px);
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.4;
            border: 2px solid #333;
        }
        .console-controls {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        /* Button Styles */
        .btn {
            background: linear-gradient(135deg, #0066CC 0%, #004499 100%);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }
        .btn:hover {
            background: linear-gradient(135deg, #0052a3 0%, #003366 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn-sm {
            padding: 4px 8px;
            font-size: 11px;
        }
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #bd2130 100%);
        }
        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #212529;
        }
        
        /* Tab System */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 15px;
            gap: 5px;
        }
        .tab {
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            transition: all 0.2s ease;
            font-size: 13px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-bottom: none;
            margin-bottom: -2px;
        }
        .tab.active {
            background: white;
            color: #0066CC;
            font-weight: 500;
            border-bottom: 2px solid white;
        }
        .tab:hover { background: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Auth User Cards */
        .user-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
        }
        .user-card strong { color: #2c3e50; }
        .user-card code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            .sidebar, .console-column {
                position: static;
                max-height: none;
            }
            .console-column {
                order: -1;
            }
            #test-console {
                height: 300px;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            .status-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Utility Classes */
        .mt-10 { margin-top: 10px; }
        .mt-15 { margin-top: 15px; }
        .mb-10 { margin-bottom: 10px; }
        .text-small { font-size: 12px; }
        .text-muted { color: #6c757d; }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div>
                <h1>üèõÔ∏è Prima Facie <span style="font-size: 0.6em; opacity: 0.7;">Test Center</span></h1>
                <p>Sistema de Gest√£o Jur√≠dica - Centro de Testes</p>
            </div>
            <div class="phase-badges">
                <span class="phase-indicator complete">‚úì Fase 1: Setup</span>
                <span class="phase-indicator complete">‚úì Fase 2: Database</span>
                <span class="phase-indicator complete">‚úì Fase 3: Auth</span>
                <span class="phase-indicator complete">‚úì Fase 4: Admin</span>
                <span class="phase-indicator complete">‚úì Fase 5: Casos</span>
                <span class="phase-indicator complete">‚úì Fase 6: Clientes</span>
                <span class="phase-indicator complete">‚úì Fase 6.5: Client-Matter Links</span>
                <span class="phase-indicator">üöß Fase 7: Chat & WhatsApp</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <!-- Quick Actions -->
            <div class="card">
                <h3>‚ö° A√ß√µes R√°pidas</h3>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="openURL('/login')">
                        <span class="icon">üö™</span>
                        <span>Login</span>
                    </button>
                    <button class="quick-action-btn" onclick="openURL('/admin')">
                        <span class="icon">‚öôÔ∏è</span>
                        <span>Admin Panel</span>
                    </button>
                    <button class="quick-action-btn" onclick="openURL('/matters/new')">
                        <span class="icon">üìù</span>
                        <span>Novo Processo</span>
                    </button>
                    <button class="quick-action-btn" onclick="openURL('/clients/new')">
                        <span class="icon">üë§</span>
                        <span>Novo Cliente</span>
                    </button>
                    <button class="quick-action-btn" onclick="detectServerPort()">
                        <span class="icon">üîç</span>
                        <span>Detectar Servidor</span>
                    </button>
                    <button class="quick-action-btn" onclick="testDatabaseConnection()">
                        <span class="icon">üóÑÔ∏è</span>
                        <span>Testar Database</span>
                    </button>
                    <button class="quick-action-btn" onclick="quickLogin('admin@test.com', '123456')">
                        <span class="icon">üöÄ</span>
                        <span>Login R√°pido (Admin)</span>
                    </button>
                    <button class="quick-action-btn" onclick="openURL('/messages')">
                        <span class="icon">üí¨</span>
                        <span>Chat/Mensagens</span>
                    </button>
                    <button class="quick-action-btn" onclick="openURL('/admin/chat-topics')">
                        <span class="icon">üè∑Ô∏è</span>
                        <span>T√≥picos de Chat</span>
                    </button>
                </div>
            </div>

            <!-- Phase 7: Chat & Messaging Testing -->
            <div class="card">
                <h3>üí¨ Phase 7: Chat & Messaging Testing</h3>
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('chat-config-tab', this)">Config</div>
                    <div class="tab" onclick="switchTab('chat-multi-user-tab', this)">Multi-User</div>
                    <div class="tab" onclick="switchTab('chat-features-tab', this)">Features</div>
                    <div class="tab" onclick="switchTab('chat-whatsapp-tab', this)">WhatsApp</div>
                </div>
                
                <div id="chat-config-tab" class="tab-content active">
                    <div class="mb-15">
                        <h4>üîß Chat Configuration</h4>
                        <div class="status-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="status-card" id="chat-mode-card">
                                <h5>üíæ Storage Mode</h5>
                                <p id="chat-mode-status">Mock Mode (Local)</p>
                                <button class="btn btn-sm" onclick="toggleChatMode()" id="chat-mode-toggle">
                                    Switch to Supabase
                                </button>
                            </div>
                            <div class="status-card" id="realtime-card">
                                <h5>‚ö° Real-time</h5>
                                <p id="realtime-status">Mock Sync (3s)</p>
                                <button class="btn btn-sm" onclick="testRealtime()">
                                    Test Sync
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="openURL('/messages')">
                            <span class="icon">üí¨</span>
                            <span>Chat Interface</span>
                        </button>
                        <button class="quick-action-btn" onclick="openURL('/admin/chat-topics')">
                            <span class="icon">üè∑Ô∏è</span>
                            <span>Topic Management</span>
                        </button>
                        <button class="quick-action-btn" onclick="openURL('/portal/client/messages')">
                            <span class="icon">üë§</span>
                            <span>Client Portal Chat</span>
                        </button>
                    </div>
                </div>
                
                <div id="chat-multi-user-tab" class="tab-content">
                    <div class="mb-15">
                        <h4>üë• Multi-User Testing</h4>
                        <p class="text-small text-muted">Open multiple browser sessions with different users to test real-time chat</p>
                    </div>
                    
                    <div class="status-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div class="user-card">
                            <strong>üëî Admin User</strong>
                            <p class="text-small">admin@test.com / 123456</p>
                            <button class="btn btn-sm btn-success" onclick="openUserSession('admin')">
                                üöÄ Open Admin Session
                            </button>
                        </div>
                        <div class="user-card">
                            <strong>‚öñÔ∏è Lawyer User</strong>
                            <p class="text-small">lawyer@test.com / 123456</p>
                            <button class="btn btn-sm btn-success" onclick="openUserSession('lawyer')">
                                üöÄ Open Lawyer Session
                            </button>
                        </div>
                        <div class="user-card">
                            <strong>üë§ Client User</strong>
                            <p class="text-small">client@test.com / 123456</p>
                            <button class="btn btn-sm btn-success" onclick="openUserSession('client')">
                                üöÄ Open Client Session
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-15">
                        <button class="btn btn-primary" onclick="openAllUserSessions()">
                            üé≠ Open All 3 Users (Multi-Test)
                        </button>
                        <button class="btn btn-secondary" onclick="testCrossUserSync()">
                            üîÑ Test Cross-User Sync
                        </button>
                    </div>
                </div>
                
                <div id="chat-features-tab" class="tab-content">
                    <div class="mb-15">
                        <h4>üß™ Feature Testing</h4>
                        <p class="text-small text-muted">Test specific chat features and functionality</p>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="testConversationCreation()">
                            <span class="icon">‚ûï</span>
                            <span>Test New Conversation</span>
                        </button>
                        <button class="quick-action-btn" onclick="testTopicFiltering()">
                            <span class="icon">üè∑Ô∏è</span>
                            <span>Test Topic Filters</span>
                        </button>
                        <button class="quick-action-btn" onclick="testMessageStatus()">
                            <span class="icon">‚úÖ</span>
                            <span>Test Message Status</span>
                        </button>
                        <button class="quick-action-btn" onclick="testNotifications()">
                            <span class="icon">üîî</span>
                            <span>Test Notifications</span>
                        </button>
                        <button class="quick-action-btn" onclick="testTypingIndicators()">
                            <span class="icon">‚úçÔ∏è</span>
                            <span>Test Typing Indicators</span>
                        </button>
                        <button class="quick-action-btn" onclick="testMobileResponsive()">
                            <span class="icon">üì±</span>
                            <span>Test Mobile View</span>
                        </button>
                    </div>
                    
                    <div id="feature-test-results" class="mt-15"></div>
                </div>
                
                <div id="chat-whatsapp-tab" class="tab-content">
                    <div class="mb-15">
                        <h4>üì± WhatsApp Integration</h4>
                        <p class="text-small text-muted">Test WhatsApp Business API integration points</p>
                    </div>
                    
                    <div class="status-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="status-card warning">
                            <h5>üîó API Status</h5>
                            <p>Mock Mode (No Real API)</p>
                            <small>Configure credentials for production</small>
                        </div>
                        <div class="status-card success">
                            <h5>üé® UI Integration</h5>
                            <p>Ready for Testing</p>
                            <small>WhatsApp indicators working</small>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="testWhatsAppIndicators()">
                            <span class="icon">üì±</span>
                            <span>Test WhatsApp UI</span>
                        </button>
                        <button class="quick-action-btn" onclick="testPhoneFormatting()">
                            <span class="icon">üìû</span>
                            <span>Test Phone Format</span>
                        </button>
                        <button class="quick-action-btn" onclick="testAutoReply()">
                            <span class="icon">ü§ñ</span>
                            <span>Test Auto-Reply</span>
                        </button>
                        <button class="quick-action-btn" onclick="openURL('/api/whatsapp/webhook')">
                            <span class="icon">üîó</span>
                            <span>Webhook Endpoint</span>
                        </button>
                    </div>
                    
                    <div id="whatsapp-test-results" class="mt-15"></div>
                </div>
            </div>

            <!-- System Status -->
            <div class="card">
                <h3>üìä Status do Sistema</h3>
                <div class="status-grid">
                    <div id="server-status-card" class="status-card warning">
                        <h4>üîå Servidor</h4>
                        <p id="server-status-text">Verificando...</p>
                    </div>
                    <div id="db-status-card" class="status-card warning">
                        <h4>üóÑÔ∏è Database</h4>
                        <p id="db-status-text">Verificando...</p>
                    </div>
                    <div id="auth-status-card" class="status-card success">
                        <h4>üîê Auth</h4>
                        <p>Mock Auth Ativo</p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="card">
                <h3>üß≠ Navega√ß√£o</h3>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="openURL('/dashboard')">
                        <span class="icon">üìä</span>
                        <span>Dashboard</span>
                    </button>
                    <button class="quick-action-btn" onclick="openURL('/matters')">
                        <span class="icon">üìã</span>
                        <span>Casos</span>
                    </button>
                    <button class="quick-action-btn" onclick="openURL('/matters/1/workflow')">
                        <span class="icon">üîÑ</span>
                        <span>Workflow Caso</span>
                    </button>
                    <button class="quick-action-btn" onclick="openURL('/clients')">
                        <span class="icon">üë•</span>
                        <span>Clientes</span>
                    </button>
                    <button class="quick-action-btn" onclick="openURL('/admin/law-firm')">
                        <span class="icon">üè¢</span>
                        <span>Escrit√≥rio</span>
                    </button>
                    <button class="quick-action-btn" onclick="openURL('/admin/users')">
                        <span class="icon">üë§</span>
                        <span>Usu√°rios</span>
                    </button>
                    <button class="quick-action-btn" onclick="openURL('/portal/client/dashboard')">
                        <span class="icon">üèõÔ∏è</span>
                        <span>Portal Cliente</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Server Management -->
            <div class="card">
                <h3>üîå Gerenciamento do Servidor</h3>
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('server-info-tab', this)">Info</div>
                    <div class="tab" onclick="switchTab('server-control-tab', this)">Controle</div>
                    <div class="tab" onclick="switchTab('server-test-tab', this)">Testes</div>
                </div>
                
                <div id="server-info-tab" class="tab-content active">
                    <div id="server-info" style="margin-bottom: 10px;">
                        <p><strong>URL:</strong> <span id="server-url">Detectando...</span></p>
                        <p><strong>Porta:</strong> <span id="server-port">Detectando...</span></p>
                        <p><strong>Status:</strong> <span id="server-status">Verificando...</span></p>
                    </div>
                    <button class="btn" onclick="detectServerPort()">üîç Detectar Porta</button>
                    <button class="btn btn-secondary" onclick="testAllEndpoints()">üåê Testar Endpoints</button>
                </div>
                
                <div id="server-control-tab" class="tab-content">
                    <p class="text-small text-muted mb-10">Controle o servidor de desenvolvimento</p>
                    <button class="btn btn-danger" onclick="killDevelopmentPorts()">üî™ Parar Portas 3000-3006</button>
                    <button class="btn btn-success" onclick="startDevelopmentServer()">üöÄ Iniciar em Porta 3000</button>
                </div>
                
                <div id="server-test-tab" class="tab-content">
                    <button class="btn" onclick="testServer()">üîÑ Testar Servidor</button>
                    <button class="btn btn-secondary" onclick="checkResponsive()">üì± Teste Responsivo</button>
                    <div id="endpoints-status" class="mt-10"></div>
                </div>
            </div>

            <!-- Database Management -->
            <div class="card">
                <h3>üóÑÔ∏è Gerenciamento do Database</h3>
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('db-setup-tab', this)">Setup</div>
                    <div class="tab" onclick="switchTab('db-test-tab', this)">Testes</div>
                    <div class="tab" onclick="switchTab('db-data-tab', this)">Dados</div>
                </div>
                
                <div id="db-setup-tab" class="tab-content active">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px;">
                        <button class="btn" onclick="openSupabaseDashboard()">üåê Abrir Dashboard</button>
                        <button class="btn btn-secondary" onclick="copySetupScript()">üìã Copiar Setup SQL</button>
                        <button class="btn btn-success" onclick="copySeedScript()">üå± Copiar Seed SQL</button>
                        <button class="btn btn-success" onclick="runDatabaseSeed()">üöÄ Executar Seeding</button>
                        <button class="btn btn-danger" onclick="fixRLSPolicies()">üîß Corrigir RLS</button>
                        <button class="btn btn-warning" onclick="checkAuthRateLimit()">‚è±Ô∏è Rate Limit</button>
                    </div>
                </div>
                
                <div id="db-test-tab" class="tab-content">
                    <button class="btn" onclick="testDatabaseConnection()">üîç Testar Conex√£o</button>
                    <button class="btn btn-secondary" onclick="testDatabaseTables()">üìä Verificar Tabelas</button>
                    <button class="btn btn-secondary" onclick="testDatabasePolicies()">üîí Verificar RLS</button>
                    <button class="btn btn-success" onclick="runFullDatabaseTest()">üß™ Teste Completo</button>
                    <div id="database-test-results" class="mt-15"></div>
                </div>
                
                <div id="db-data-tab" class="tab-content">
                    <p class="text-small text-muted">Dados seedados no banco:</p>
                    <ul class="text-small">
                        <li>3 escrit√≥rios de advocacia</li>
                        <li>8 usu√°rios (admin, advogados, staff, clientes)</li>
                        <li>Dados completos para testes</li>
                    </ul>
                    <button class="btn btn-secondary" onclick="showTableSchema()">üìã Ver Schema</button>
                </div>
            </div>

            <!-- Authentication -->
            <div class="card">
                <h3>üîê Autentica√ß√£o - Mock Auth Ativo</h3>
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('auth-users-tab', this)">Usu√°rios</div>
                    <div class="tab" onclick="switchTab('auth-config-tab', this)">Config</div>
                    <div class="tab" onclick="switchTab('auth-test-tab', this)">Testes</div>
                </div>
                
                <div id="auth-users-tab" class="tab-content active">
                    <div class="user-card">
                        <strong>üëî Admin</strong> - <code>admin@test.com</code> / <code>123456</code>
                        <button class="btn btn-sm" onclick="quickLogin('admin@test.com', '123456')" style="float: right;">Login</button>
                    </div>
                    <div class="user-card">
                        <strong>‚öñÔ∏è Advogado</strong> - <code>lawyer@test.com</code> / <code>123456</code>
                        <button class="btn btn-sm" onclick="quickLogin('lawyer@test.com', '123456')" style="float: right;">Login</button>
                    </div>
                    <div class="user-card">
                        <strong>üë§ Cliente</strong> - <code>client@test.com</code> / <code>123456</code>
                        <button class="btn btn-sm" onclick="quickLogin('client@test.com', '123456')" style="float: right;">Login</button>
                    </div>
                </div>
                
                <div id="auth-config-tab" class="tab-content">
                    <p class="text-small text-muted">Mock Auth est√° ativo para evitar rate limits.</p>
                    <button class="btn btn-secondary" onclick="disableMockAuth()">üîÑ Desativar Mock Auth</button>
                    <button class="btn" onclick="enableMockAuth()">‚úÖ Manter Mock Auth</button>
                </div>
                
                <div id="auth-test-tab" class="tab-content">
                    <button class="btn" onclick="openRegister()">üìù Criar Conta</button>
                    <button class="btn" onclick="openLogin()">üö™ Fazer Login</button>
                    <button class="btn btn-success" onclick="testAuthFlow()">üß™ Testar Fluxo</button>
                    <div id="auth-test-result" class="mt-15"></div>
                </div>
            </div>

            <!-- Development Info -->
            <div class="card">
                <h3>üîß Informa√ß√µes do Ambiente</h3>
                <div id="env-info" class="text-small"></div>
                <div class="mt-10">
                    <button class="btn btn-secondary" onclick="refreshEnvInfo()">üîÑ Atualizar</button>
                    <button class="btn btn-secondary" onclick="exportTestReport()">üìÑ Exportar Relat√≥rio</button>
                </div>
            </div>
        </main>

        <!-- Right Console -->
        <aside class="console-column">
            <div class="card" style="height: 100%;">
                <h3>üìã Console de Testes</h3>
                <div id="test-console"></div>
                <div class="console-controls">
                    <button class="btn btn-sm btn-secondary" onclick="clearConsole()">üóëÔ∏è Limpar</button>
                    <button class="btn btn-sm btn-secondary" onclick="toggleAutoScroll()">üìú Auto: <span id="autoscroll-status">ON</span></button>
                    <button class="btn btn-sm btn-secondary" onclick="saveConsoleLogs()">üíæ Salvar</button>
                    <button class="btn btn-sm btn-secondary" onclick="toggleConsoleSize()">üîç <span id="console-size-status">Normal</span></button>
                </div>
            </div>
        </aside>
    </div>

    <script>
        // Global variables
        let testResults = [];
        let autoScroll = true;
        let consoleExpanded = false;
        
        // Initialize
        window.onload = function() {
            logToConsole('üöÄ Prima Facie Test Center iniciado');
            logToConsole('‚úÖ Mock Auth ativo - use credenciais de teste');
            detectServerPort();
            testDatabaseConnection();
            refreshEnvInfo();
            updateTimestamp();
        };

        // Console functions
        function logToConsole(message) {
            const console = document.getElementById('test-console');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #888;">[${timestamp}]</span> <span style="color: #00ff00;">${message}</span>`;
            console.appendChild(logEntry);
            
            if (autoScroll) {
                console.scrollTop = console.scrollHeight;
            }
            
            // Keep only last 200 entries
            const entries = console.children;
            if (entries.length > 200) {
                entries[0].remove();
            }
        }

        function clearConsole() {
            document.getElementById('test-console').innerHTML = '';
            logToConsole('üóëÔ∏è Console limpo');
        }

        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            document.getElementById('autoscroll-status').textContent = autoScroll ? 'ON' : 'OFF';
            logToConsole(`üìú Auto-scroll ${autoScroll ? 'ativado' : 'desativado'}`);
        }

        function saveConsoleLogs() {
            const console = document.getElementById('test-console');
            const logs = Array.from(console.children).map(entry => entry.textContent).join('\n');
            
            const dataStr = `Prima Facie - Console Logs\nTimestamp: ${new Date().toISOString()}\n\n${logs}`;
            const dataBlob = new Blob([dataStr], {type: 'text/plain'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `prima-facie-console-${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            
            logToConsole('üíæ Logs salvos em arquivo');
        }

        function toggleConsoleSize() {
            const console = document.getElementById('test-console');
            const statusSpan = document.getElementById('console-size-status');
            
            if (consoleExpanded) {
                console.style.height = 'calc(100vh - 300px)';
                statusSpan.textContent = 'Normal';
                consoleExpanded = false;
            } else {
                console.style.height = 'calc(100vh - 200px)';
                statusSpan.textContent = 'Expandido';
                consoleExpanded = true;
            }
        }

        // Server functions
        async function detectServerPort() {
            const ports = [3001, 3000, 3002, 3003, 3004, 3005];
            let serverFound = false;
            
            logToConsole('üîç Detectando servidor...');
            
            for (const port of ports) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 2000);
                    
                    const response = await fetch(`http://localhost:${port}`, { 
                        method: 'HEAD',
                        mode: 'no-cors',
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    
                    // Update UI
                    document.getElementById('server-url').textContent = `http://localhost:${port}`;
                    document.getElementById('server-port').textContent = port;
                    document.getElementById('server-status').textContent = 'Online';
                    document.getElementById('server-status-text').textContent = `Porta ${port}`;
                    document.getElementById('server-status-card').className = 'status-card success';
                    
                    logToConsole(`‚úÖ Servidor encontrado na porta ${port}`);
                    serverFound = true;
                    break;
                    
                } catch (error) {
                    // Continue to next port
                }
            }
            
            if (!serverFound) {
                document.getElementById('server-status').textContent = 'Offline';
                document.getElementById('server-status-text').textContent = 'N√£o encontrado';
                document.getElementById('server-status-card').className = 'status-card error';
                logToConsole('‚ùå Nenhum servidor encontrado');
            }
        }

        async function testServer() {
            await detectServerPort();
        }

        function killDevelopmentPorts() {
            logToConsole('üî™ Parando processos nas portas 3000-3006...');
            const killCommand = 'lsof -ti:3000,3001,3002,3003,3004,3005,3006 | xargs kill -9';
            
            navigator.clipboard.writeText(killCommand).then(() => {
                logToConsole('üìã Comando copiado para clipboard!');
                logToConsole('Execute no terminal para parar os servidores');
            });
        }

        function startDevelopmentServer() {
            logToConsole('üöÄ Iniciando servidor de desenvolvimento...');
            const startCommand = 'cd /Users/20015403/Documents/PROJECTS/personal/prima-facie && npm run dev';
            
            navigator.clipboard.writeText(startCommand).then(() => {
                logToConsole('üìã Comando copiado para clipboard!');
                logToConsole('Execute no terminal para iniciar o servidor');
            });
            
            setTimeout(() => {
                logToConsole('üîç Auto-detectando servidor em 5 segundos...');
                setTimeout(detectServerPort, 5000);
            }, 1000);
        }

        async function testAllEndpoints() {
            const endpoints = ['/', '/login', '/register', '/dashboard', '/admin'];
            const serverPort = document.getElementById('server-port').textContent || '3000';
            
            logToConsole(`üîç Testando endpoints na porta ${serverPort}...`);
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(`http://localhost:${serverPort}${endpoint}`, { mode: 'no-cors' });
                    logToConsole(`‚úÖ ${endpoint} - OK`);
                } catch (error) {
                    logToConsole(`‚ùå ${endpoint} - ${error.message}`);
                }
            }
        }

        // Database functions
        async function testDatabaseConnection() {
            logToConsole('üîç Testando conex√£o com database...');
            
            try {
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                document.getElementById('db-status-text').textContent = 'Conectado';
                document.getElementById('db-status-card').className = 'status-card success';
                logToConsole('‚úÖ Conex√£o com Supabase estabelecida');
                
            } catch (error) {
                document.getElementById('db-status-text').textContent = 'Erro';
                document.getElementById('db-status-card').className = 'status-card error';
                logToConsole(`‚ùå Erro de conex√£o: ${error.message}`);
            }
        }

        function openSupabaseDashboard() {
            window.open('https://supabase.com/dashboard', '_blank');
            logToConsole('üåê Abrindo Supabase Dashboard');
        }

        function copySetupScript() {
            const script = `-- Prima Facie Setup Script`;
            navigator.clipboard.writeText(script).then(() => {
                logToConsole('üìã Setup SQL copiado para clipboard');
            });
        }

        function copySeedScript() {
            logToConsole('üìã Copiando seed script...');
            // Implementation would go here
        }

        function runDatabaseSeed() {
            logToConsole('üöÄ Executando database seeding...');
            // Implementation would go here
        }

        function fixRLSPolicies() {
            logToConsole('üîß Corrigindo RLS policies...');
            // Implementation would go here
        }

        function checkAuthRateLimit() {
            logToConsole('‚è±Ô∏è Verificando rate limit...');
            // Implementation would go here
        }

        function testDatabaseTables() {
            logToConsole('üìä Verificando tabelas...');
        }

        function testDatabasePolicies() {
            logToConsole('üîí Verificando RLS policies...');
        }

        function runFullDatabaseTest() {
            logToConsole('üß™ Executando teste completo do database...');
        }

        function showTableSchema() {
            logToConsole('üìã Exibindo schema das tabelas...');
        }

        // Navigation functions
        function openURL(path) {
            const serverPort = document.getElementById('server-port').textContent || '3000';
            const url = `http://localhost:${serverPort}${path}`;
            window.open(url, '_blank');
            logToConsole(`üîó Abrindo: ${url}`);
        }

        function openLogin() {
            openURL('/login');
        }

        function openRegister() {
            openURL('/register');
        }

        async function quickLogin(email, password) {
            logToConsole(`üöÄ Login r√°pido: ${email}`);
            
            const credentials = `Email: ${email}\nSenha: ${password}`;
            await navigator.clipboard.writeText(credentials);
            
            logToConsole('üìã Credenciais copiadas para clipboard');
            openURL('/login');
        }

        // Auth functions
        function enableMockAuth() {
            logToConsole('‚úÖ Mock Auth j√° est√° ativo!');
        }

        function disableMockAuth() {
            logToConsole('üîÑ Para desativar Mock Auth:');
            logToConsole('1. Edite .env.local');
            logToConsole('2. Mude NEXT_PUBLIC_USE_MOCK_AUTH=false');
            logToConsole('3. Reinicie o servidor');
        }

        function testAuthFlow() {
            logToConsole('üß™ Testando fluxo de autentica√ß√£o...');
            document.getElementById('auth-test-result').innerHTML = '<p class="text-small">Teste iniciado...</p>';
        }

        // Environment functions
        function refreshEnvInfo() {
            const envData = {
                'URL': window.location.href,
                'User Agent': navigator.userAgent.split(') ')[0] + ')',
                'Viewport': `${window.innerWidth}x${window.innerHeight}px`,
                'Mock Auth': '‚úÖ Ativo',
                'Database': 'Supabase PostgreSQL'
            };
            
            let infoHTML = '';
            Object.entries(envData).forEach(([key, value]) => {
                infoHTML += `<div><strong>${key}:</strong> ${value}</div>`;
            });
            
            document.getElementById('env-info').innerHTML = infoHTML;
        }

        function exportTestReport() {
            logToConsole('üìÑ Exportando relat√≥rio de testes...');
            // Implementation would go here
        }

        function checkResponsive() {
            const width = window.innerWidth;
            const device = width <= 768 ? 'üì± Mobile' : width <= 1200 ? 'üì± Tablet' : 'üñ•Ô∏è Desktop';
            logToConsole(`${device} - ${width}px`);
        }

        // Tab switching
        function switchTab(tabId, element) {
            // Find parent tabs container
            const tabsContainer = element.parentElement;
            const contentContainer = tabsContainer.parentElement;
            
            // Remove active from all tabs and contents
            tabsContainer.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            contentContainer.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active to clicked tab and corresponding content
            element.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // Timestamp update
        function updateTimestamp() {
            // Implementation would update any timestamp displays
        }

        // ==============================================
        // PHASE 7: CHAT & MESSAGING TESTING FUNCTIONS
        // ==============================================

        // Chat mode configuration
        let chatMode = 'mock'; // 'mock' or 'supabase'
        
        function toggleChatMode() {
            const card = document.getElementById('chat-mode-card');
            const status = document.getElementById('chat-mode-status');
            const toggle = document.getElementById('chat-mode-toggle');
            
            if (chatMode === 'mock') {
                chatMode = 'supabase';
                status.textContent = 'Supabase Mode (Live)';
                toggle.textContent = 'Switch to Mock';
                card.className = 'status-card success';
                logToConsole('üíæ Switched to Supabase mode');
                logToConsole('‚ö†Ô∏è Note: Requires real Supabase setup');
            } else {
                chatMode = 'mock';
                status.textContent = 'Mock Mode (Local)';
                toggle.textContent = 'Switch to Supabase';
                card.className = 'status-card warning';
                logToConsole('üíæ Switched to Mock mode');
                logToConsole('‚úÖ Using local mock data for testing');
            }
        }

        function testRealtime() {
            logToConsole('‚ö° Testing real-time sync...');
            if (chatMode === 'mock') {
                logToConsole('üì° Mock sync: 3-second polling active');
                logToConsole('üîÑ Cross-user sync working via shared mock store');
            } else {
                logToConsole('üì° Testing Supabase Realtime connection...');
                logToConsole('‚ö†Ô∏è Real Supabase required for live testing');
            }
        }

        // Multi-user session management
        function openUserSession(userType) {
            const serverPort = document.getElementById('server-port').textContent || '3000';
            const credentials = {
                admin: { email: 'admin@test.com', password: '123456' },
                lawyer: { email: 'lawyer@test.com', password: '123456' },
                client: { email: 'client@test.com', password: '123456' }
            };
            
            if (!credentials[userType]) {
                logToConsole(`‚ùå Unknown user type: ${userType}`);
                return;
            }
            
            const cred = credentials[userType];
            const loginUrl = `http://localhost:${serverPort}/login`;
            
            // Open new incognito-like window
            const newWindow = window.open(loginUrl, `_blank_${userType}_${Date.now()}`, 
                'width=1200,height=800,scrollbars=yes,resizable=yes,toolbar=no,menubar=no,location=no');
            
            if (newWindow) {
                logToConsole(`üöÄ Opened ${userType} session: ${cred.email}`);
                logToConsole(`üîë Use credentials: ${cred.email} / ${cred.password}`);
                
                // Try to copy credentials to clipboard for convenience
                navigator.clipboard.writeText(`${cred.email}\n${cred.password}`).then(() => {
                    logToConsole('üìã Credentials copied to clipboard');
                }).catch(() => {
                    logToConsole('üìã Manual login required');
                });
            } else {
                logToConsole('‚ùå Failed to open new window (popup blocked?)');
            }
        }

        function openAllUserSessions() {
            logToConsole('üé≠ Opening all user sessions for multi-user testing...');
            
            setTimeout(() => openUserSession('admin'), 100);
            setTimeout(() => openUserSession('lawyer'), 1000);
            setTimeout(() => openUserSession('client'), 2000);
            
            logToConsole('üìù Multi-user testing guide:');
            logToConsole('1. Login to each window with the provided credentials');
            logToConsole('2. Navigate to /messages in each window');
            logToConsole('3. Create a conversation in admin/lawyer window');
            logToConsole('4. Test real-time sync between windows');
            logToConsole('5. Send messages and verify delivery status');
        }

        function testCrossUserSync() {
            logToConsole('üîÑ Testing cross-user synchronization...');
            logToConsole('üìã Cross-sync test checklist:');
            logToConsole('‚úì Open multiple user sessions first');
            logToConsole('‚úì Create conversation in one window');
            logToConsole('‚úì Check if it appears in other windows');
            logToConsole('‚úì Send messages and verify real-time delivery');
            logToConsole('‚úì Test notification system');
            
            if (chatMode === 'mock') {
                logToConsole('‚öôÔ∏è Mock mode: Using 3-second polling for sync');
                logToConsole('üîÑ Shared mock store enables cross-window sync');
            } else {
                logToConsole('‚öôÔ∏è Supabase mode: Using Realtime subscriptions');
            }
        }

        // Feature testing functions
        function testConversationCreation() {
            logToConsole('‚ûï Testing conversation creation...');
            logToConsole('üìã Conversation creation test:');
            logToConsole('1. Open /messages as admin or lawyer');
            logToConsole('2. Click "+" button to create new conversation');
            logToConsole('3. Select client (e.g., "Maria Santos")');
            logToConsole('4. Choose topic and priority');
            logToConsole('5. Verify conversation appears in list');
            logToConsole('6. Test first message sending');
            
            // Open the messages page
            openURL('/messages');
        }

        function testTopicFiltering() {
            logToConsole('üè∑Ô∏è Testing topic filtering system...');
            logToConsole('üìã Topic filtering test:');
            logToConsole('1. Open /admin/chat-topics to manage topics');
            logToConsole('2. Create new topics if needed');
            logToConsole('3. Open /messages and create conversations with different topics');
            logToConsole('4. Use filter icon to test topic filtering');
            logToConsole('5. Verify conversations are filtered correctly');
            
            // Open both admin topics and messages
            setTimeout(() => openURL('/admin/chat-topics'), 100);
            setTimeout(() => openURL('/messages'), 1500);
        }

        function testMessageStatus() {
            logToConsole('‚úÖ Testing message status indicators...');
            logToConsole('üìã Message status test:');
            logToConsole('1. Send messages in active conversation');
            logToConsole('2. Check for status indicators: sent ‚úì, delivered ‚úì‚úì, read ‚úì‚úì(blue)');
            logToConsole('3. Test across different user sessions');
            logToConsole('4. Verify WhatsApp status indicators if enabled');
            
            document.getElementById('feature-test-results').innerHTML = `
                <div class="status-card">
                    <h5>‚úÖ Message Status Types</h5>
                    <p>‚Ä¢ <span style="color: #888;">‚úì</span> Sent (gray)</p>
                    <p>‚Ä¢ <span style="color: #888;">‚úì‚úì</span> Delivered (gray)</p>
                    <p>‚Ä¢ <span style="color: #0066CC;">‚úì‚úì</span> Read (blue)</p>
                    <p>‚Ä¢ <span style="color: #dc2626;">‚ùå</span> Failed (red)</p>
                </div>
            `;
            
            openURL('/messages');
        }

        function testNotifications() {
            logToConsole('üîî Testing notification system...');
            logToConsole('üìã Notification test:');
            logToConsole('1. Open multiple user sessions');
            logToConsole('2. Send message from one user to another');
            logToConsole('3. Check notification panel (bell icon) in recipient window');
            logToConsole('4. Verify unread count appears');
            logToConsole('5. Click notification to mark as read');
            
            openURL('/messages');
        }

        function testTypingIndicators() {
            logToConsole('‚úçÔ∏è Testing typing indicators...');
            logToConsole('üìã Typing indicator test:');
            logToConsole('1. Open same conversation in multiple windows');
            logToConsole('2. Start typing in one window');
            logToConsole('3. Check for "User is typing..." indicator in other window');
            logToConsole('4. Verify indicator disappears after stopping');
            
            openURL('/messages');
        }

        function testMobileResponsive() {
            logToConsole('üì± Testing mobile responsive design...');
            
            // Simulate mobile viewport
            const currentWidth = window.innerWidth;
            logToConsole(`üìè Current viewport: ${currentWidth}px`);
            
            if (currentWidth > 768) {
                logToConsole('üíª Desktop view detected');
                logToConsole('üìã Responsive test:');
                logToConsole('1. Resize browser window to < 768px width');
                logToConsole('2. Open /messages');
                logToConsole('3. Verify mobile layout: conversation list OR chat interface');
                logToConsole('4. Test navigation between list and chat');
                logToConsole('5. Check touch-friendly buttons and spacing');
            } else {
                logToConsole('üì± Mobile view detected');
                logToConsole('‚úÖ Mobile layout should be active');
            }
            
            openURL('/messages');
        }

        // WhatsApp integration testing
        function testWhatsAppIndicators() {
            logToConsole('üì± Testing WhatsApp UI indicators...');
            logToConsole('üìã WhatsApp UI test:');
            logToConsole('1. Create conversation with WhatsApp enabled');
            logToConsole('2. Check for WhatsApp icons (üì±) in conversation list');
            logToConsole('3. Verify green phone indicator');
            logToConsole('4. Test WhatsApp status in chat header');
            
            document.getElementById('whatsapp-test-results').innerHTML = `
                <div class="status-card">
                    <h5>üì± WhatsApp Indicators</h5>
                    <p>‚Ä¢ üì± Icon in conversation list</p>
                    <p>‚Ä¢ üü¢ Green phone indicator</p>
                    <p>‚Ä¢ "WhatsApp" text in chat header</p>
                    <p>‚Ä¢ Special message status for WhatsApp</p>
                </div>
            `;
            
            openURL('/messages');
        }

        function testPhoneFormatting() {
            logToConsole('üìû Testing phone number formatting...');
            logToConsole('üìã Phone format test:');
            logToConsole('1. Create conversation with WhatsApp');
            logToConsole('2. Enter phone numbers in different formats');
            logToConsole('3. Verify Brazilian format: +55 (11) 99999-9999');
            logToConsole('4. Test international formats');
        }

        function testAutoReply() {
            logToConsole('ü§ñ Testing WhatsApp auto-reply system...');
            logToConsole('üìã Auto-reply test:');
            logToConsole('1. Send message to WhatsApp-enabled conversation');
            logToConsole('2. Check for auto-reply configuration');
            logToConsole('3. Verify business hours handling');
            logToConsole('4. Test custom auto-reply messages');
            
            logToConsole('‚ö†Ô∏è Note: Auto-reply requires WhatsApp Business API setup');
        }

        // Chat testing helper functions
        function logChatTestResult(testName, result, details = '') {
            const timestamp = new Date().toLocaleTimeString();
            const status = result ? '‚úÖ' : '‚ùå';
            logToConsole(`${status} ${testName} - ${result ? 'PASS' : 'FAIL'} ${details}`);
        }

        function createChatTestSummary() {
            logToConsole('üìä Chat Testing Summary:');
            logToConsole('='.repeat(40));
            logToConsole('üìã Completed Tests:');
            logToConsole('‚úì Chat mode configuration');
            logToConsole('‚úì Multi-user session setup');
            logToConsole('‚úì Feature testing functions');
            logToConsole('‚úì WhatsApp integration points');
            logToConsole('='.repeat(40));
        }

        // Enhanced console logging for chat tests
        function logChatError(error, context = '') {
            logToConsole(`‚ùå Chat Error${context ? ` (${context})` : ''}: ${error}`);
        }

        function logChatSuccess(message, context = '') {
            logToConsole(`‚úÖ Chat Success${context ? ` (${context})` : ''}: ${message}`);
        }

        function logChatWarning(message, context = '') {
            logToConsole(`‚ö†Ô∏è Chat Warning${context ? ` (${context})` : ''}: ${message}`);
        }
    </script>
</body>
</html>